// Template: crud_view_controller.ts
import { Request, Response } from "express";
import { AppDataSource } from "../../data-source";
import { {{name}} } from "../../Entity/{{name}}";

export class {{name}}Controller {
    private repository = AppDataSource.getRepository({{name}});

    public async index(req: Request, res: Response) {
        const items = await this.repository.find();
        // Rend le template views/{{nameLower}}/index.html
        return res.render("{{nameLower}}/index", { items });
    }

    public async create(req: Request, res: Response) {
        if (req.method === "POST") {
            const item = this.repository.create(req.body);
            await this.repository.save(item);
            return res.redirect("/{{nameLower}}");
        }
        return res.render("{{nameLower}}/create");
    }

    public async edit(req: Request, res: Response) {
        const item = await this.repository.findOneBy({ id: req.params.id as any });
        if (req.method === "POST") {
            this.repository.merge(item!, req.body);
            await this.repository.save(item!);
            return res.redirect("/{{nameLower}}");
        }
        return res.render("{{nameLower}}/edit", { item });
    }
}